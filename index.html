<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>–£—á–µ—Ç - –ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
        :root {
            --bg-body: #f4f7fc;
            --bg-container: white;
            --text-primary: #2c3e50;
            --text-secondary: #4a5568;
            --border-color: #e2e8f0;
            --input-bg: white;
            --input-border: #cbd5e0;
            --table-header-bg: #f7fafc;
            --table-row-hover: #f8fafd;
            --shadow-color: rgba(0,0,0,0.1);
            --gradient-start: #667eea;
            --gradient-end: #764ba2;
            --btn-primary: #667eea;
            --btn-primary-hover: #5a67d8;
            --btn-secondary: #48bb78;
            --btn-secondary-hover: #38a169;
            --btn-danger: #f56565;
            --btn-danger-hover: #e53e3e;
            --btn-info: #4299e1;
            --btn-info-hover: #3182ce;
            --sync-success-bg: #c6f6d5;
            --sync-success-text: #22543d;
            --sync-error-bg: #fed7d7;
            --sync-error-text: #742a2a;
            --sync-loading-bg: #feebc8;
            --sync-loading-text: #7b341e;
            --telegram-bg: #e1f5fe;
            --telegram-text: #01579b;
            --footer-text: #718096;
            --total-row-bg: #f0f4f8;
            --checkbox-group-bg: #f8fafd;
            --filter-bar-bg: white;
            --form-section-bg: #f8fafd;
            --stat-bg: #f8fafd;
            --stat-header-bg: #667eea;
            --stat-text: white;
            --reminder-bg: #fff3cd;
            --reminder-border: #ffeeba;
            --reminder-text: #856404;
        }

        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
        [data-theme="dark"] {
            --bg-body: #1a202c;
            --bg-container: #2d3748;
            --text-primary: #e2e8f0;
            --text-secondary: #a0aec0;
            --border-color: #4a5568;
            --input-bg: #4a5568;
            --input-border: #718096;
            --table-header-bg: #4a5568;
            --table-row-hover: #3f4a5a;
            --shadow-color: rgba(0,0,0,0.3);
            --gradient-start: #4c51bf;
            --gradient-end: #6b46c1;
            --btn-primary: #5a67d8;
            --btn-primary-hover: #4c51bf;
            --btn-secondary: #2f855a;
            --btn-secondary-hover: #276749;
            --btn-danger: #c53030;
            --btn-danger-hover: #9b2c2c;
            --btn-info: #3182ce;
            --btn-info-hover: #2c5282;
            --sync-success-bg: #276749;
            --sync-success-text: #c6f6d5;
            --sync-error-bg: #742a2a;
            --sync-error-text: #fed7d7;
            --sync-loading-bg: #7b341e;
            --sync-loading-text: #feebc8;
            --telegram-bg: #2c5282;
            --telegram-text: #e1f5fe;
            --footer-text: #a0aec0;
            --total-row-bg: #4a5568;
            --checkbox-group-bg: #4a5568;
            --filter-bar-bg: #2d3748;
            --form-section-bg: #4a5568;
            --stat-bg: #4a5568;
            --stat-header-bg: #5a67d8;
            --stat-text: white;
            --reminder-bg: #7b341e;
            --reminder-border: #9b2c2c;
            --reminder-text: #feebc8;
        }

        body {
            background: var(--bg-body);
            margin: 0;
            padding: 10px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –≤—Ö–æ–¥–∞ */
        .login-container {
            max-width: 400px;
            width: 100%;
            background: var(--bg-container);
            border-radius: 20px;
            box-shadow: 0 10px 30px var(--shadow-color);
            padding: 30px;
            margin: auto;
        }
        
        .login-container h2 {
            color: var(--text-primary);
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-form .form-group {
            margin-bottom: 20px;
        }
        
        .login-form label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .login-form input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--input-border);
            border-radius: 10px;
            font-size: 1rem;
            transition: 0.2s;
            background: var(--input-bg);
            color: var(--text-primary);
        }
        
        .login-form input:focus {
            border-color: var(--btn-primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }
        
        .login-btn {
            width: 100%;
            background: var(--btn-primary);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .login-btn:hover {
            background: var(--btn-primary-hover);
        }
        
        .error-message {
            color: var(--btn-danger);
            text-align: center;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .sync-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 10px;
            font-weight: normal;
        }
        
        .sync-success {
            background: var(--sync-success-bg);
            color: var(--sync-success-text);
        }
        
        .sync-error {
            background: var(--sync-error-bg);
            color: var(--sync-error-text);
        }
        
        .sync-loading {
            background: var(--sync-loading-bg);
            color: var(--sync-loading-text);
        }
        
        .telegram-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 10px;
            background: var(--telegram-bg);
            color: var(--telegram-text);
            cursor: pointer;
            transition: 0.2s;
        }
        
        .telegram-status:hover {
            opacity: 0.8;
        }
        
        .telegram-success {
            background: var(--sync-success-bg);
            color: var(--sync-success-text);
        }
        
        .telegram-error {
            background: var(--sync-error-bg);
            color: var(--sync-error-text);
        }
        
        .telegram-warning {
            background: var(--sync-loading-bg);
            color: var(--sync-loading-text);
        }
        
        .header-with-logout {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .theme-toggle {
            background: var(--bg-container);
            border: 1px solid var(--border-color);
            border-radius: 30px;
            padding: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 1.2rem;
            box-shadow: 0 2px 5px var(--shadow-color);
        }
        
        .theme-toggle span {
            padding: 5px 10px;
            border-radius: 25px;
            transition: 0.2s;
        }
        
        .theme-toggle .active {
            background: var(--btn-primary);
            color: white;
        }
        
        .logout-btn {
            background: var(--btn-danger);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .logout-btn:hover {
            background: var(--btn-danger-hover);
        }
        
        .stats-toggle-btn {
            background: var(--btn-info);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-right: 10px;
        }
        
        .stats-toggle-btn:hover {
            background: var(--btn-info-hover);
        }
        
        .container {
            max-width: 1400px;
            width: 100%;
            background: var(--bg-container);
            border-radius: 20px;
            box-shadow: 0 10px 30px var(--shadow-color);
            padding: 15px;
        }
        h1 {
            color: var(--text-primary);
            margin-top: 0;
            margin-bottom: 0;
            font-weight: 600;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        /* –û—Ç—á–µ—Ç - –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
        .report-panel {
            background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .report-item {
            text-align: center;
        }
        .report-item span {
            display: block;
            font-size: 1.8rem;
            font-weight: bold;
            line-height: 1.2;
        }
        .report-item label {
            font-size: 0.8rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
            word-break: break-word;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-section {
            background: var(--stat-bg);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        
        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .stats-header h3 {
            margin: 0;
            color: var(--text-primary);
            font-size: 1.2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .stat-card {
            background: var(--bg-container);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 5px var(--shadow-color);
        }
        
        .stat-card h4 {
            margin: 0 0 10px 0;
            color: var(--text-primary);
            font-size: 1rem;
            text-transform: uppercase;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .stat-row:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            color: var(--text-secondary);
        }
        
        .stat-value {
            font-weight: bold;
            color: var(--text-primary);
        }
        
        .reminder-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .reminder-item {
            background: var(--reminder-bg);
            border: 1px solid var(--reminder-border);
            color: var(--reminder-text);
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .reminder-item:last-child {
            margin-bottom: 0;
        }
        
        .reminder-contact {
            display: flex;
            gap: 10px;
        }
        
        .reminder-contact button {
            background: var(--btn-primary);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .reminder-contact button:hover {
            background: var(--btn-primary-hover);
        }
        
        /* –§–æ—Ä–º–∞ - –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
        .form-section {
            background: var(--form-section-bg);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        .form-section h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1.2rem;
        }
        .form-row {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .form-group {
            width: 100%;
        }
        .form-group label {
            display: block;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 4px;
            text-transform: uppercase;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--input-border);
            border-radius: 10px;
            font-size: 1rem;
            transition: 0.2s;
            background: var(--input-bg);
            color: var(--text-primary);
            font-family: inherit;
            -webkit-appearance: none;
            appearance: none;
        }
        .form-group input[type="number"] {
            -moz-appearance: textfield;
        }
        .form-group input[type="number"]::-webkit-outer-spin-button,
        .form-group input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--btn-primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }
        .form-group input[readonly] {
            background: var(--form-section-bg);
            cursor: not-allowed;
            opacity: 0.7;
        }
        .btn {
            background: var(--btn-primary);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            border: 1px solid transparent;
            font-size: 1rem;
            width: 100%;
            margin-bottom: 8px;
            -webkit-tap-highlight-color: transparent;
        }
        .btn:hover {
            background: var(--btn-primary-hover);
        }
        .btn:active {
            transform: scale(0.98);
        }
        .btn-secondary {
            background: var(--btn-secondary);
        }
        .btn-secondary:hover {
            background: var(--btn-secondary-hover);
        }
        .btn-danger {
            background: var(--btn-danger);
        }
        .btn-danger:hover {
            background: var(--btn-danger-hover);
        }
        .clear-btn {
            background: var(--border-color);
            color: var(--text-primary);
        }
        .clear-btn:hover {
            background: var(--text-secondary);
            color: white;
        }
        .form-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
        }
        /* –§–∏–ª—å—Ç—Ä—ã - –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
        .filter-bar {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
            background: var(--filter-bar-bg);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 2px 10px var(--shadow-color);
            border: 1px solid var(--border-color);
        }
        .filter-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .search-box input {
            width: 100%;
            padding: 14px 15px;
            border: 1px solid var(--border-color);
            border-radius: 30px;
            font-size: 1rem;
            -webkit-appearance: none;
            background: var(--input-bg);
            color: var(--text-primary);
        }
        .filter-section {
            width: 100%;
        }
        .filter-section label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            background: var(--checkbox-group-bg);
            padding: 12px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text-primary);
            flex: 1 1 calc(50% - 12px);
            min-width: 120px;
            -webkit-tap-highlight-color: transparent;
        }
        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--btn-primary);
        }
        .info-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            background: var(--btn-primary);
            color: white;
            margin-left: 5px;
            vertical-align: middle;
        }
        .date-filter {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .date-filter select {
            flex: 1 1 120px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 30px;
            font-size: 0.95rem;
            background: var(--input-bg);
            color: var(--text-primary);
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20stroke%3D%22%234a5568%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3Cpolyline%20points%3D%226%209%2012%2015%2018%209%22%3E%3C%2Fpolyline%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }
        .table-wrapper {
            overflow-x: auto;
            border-radius: 15px;
            border: 1px solid var(--border-color);
            background: var(--bg-container);
            margin: 0 -5px;
            -webkit-overflow-scrolling: touch;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1300px;
        }
        th {
            background: var(--table-header-bg);
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            padding: 12px 8px;
            text-align: left;
            border-bottom: 2px solid var(--border-color);
            white-space: nowrap;
        }
        td {
            padding: 10px 8px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
            font-size: 0.85rem;
            vertical-align: top;
            white-space: nowrap;
        }
        tr:hover td {
            background: var(--table-row-hover);
        }
        .total-row {
            background: var(--total-row-bg);
            font-weight: 700;
            border-top: 2px solid var(--btn-primary);
        }
        .total-row td {
            padding: 12px 8px;
            background: var(--total-row-bg);
        }
        .comment-cell {
            max-width: 150px;
            white-space: normal;
            word-wrap: break-word;
            min-width: 120px;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 30px;
            font-size: 0.7rem;
            font-weight: 600;
            text-align: center;
            white-space: nowrap;
        }
        .oil-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            white-space: nowrap;
        }
        .payment-cell {
            text-align: right;
            font-weight: 500;
        }
        .status-done {
            background: #c6f6d5;
            color: #22543d;
        }
        .status-late {
            background: #fed7d7;
            color: #742a2a;
        }
        .status-notcome {
            background: #e2e8f0;
            color: #2d3748;
        }
        .status-waiting {
            background: #fefcbf;
            color: #744210;
        }
        .oil-yes {
            background: #c6f6d5;
            color: #22543d;
        }
        .oil-no {
            background: #e2e8f0;
            color: #2d3748;
        }
        .oil-soon {
            background: #fefcbf;
            color: #744210;
        }
        .actions {
            display: flex;
            gap: 8px;
        }
        .actions button {
            border: none;
            background: none;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 6px;
            border-radius: 6px;
            transition: 0.1s;
            -webkit-tap-highlight-color: transparent;
            color: var(--text-primary);
        }
        .edit-btn:hover {
            background: var(--btn-primary);
            color: white;
        }
        .delete-btn:hover {
            background: var(--btn-danger);
            color: white;
        }
        .footer-note {
            margin-top: 15px;
            font-size: 0.75rem;
            color: var(--footer-text);
            text-align: center;
        }
        
        /* –ú–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ —ç–∫—Ä–∞–Ω–∞ */
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
            .container {
                padding: 25px;
            }
            h1 {
                font-size: 2rem;
                text-align: left;
            }
            .report-panel {
                grid-template-columns: repeat(4, 1fr);
                padding: 20px;
            }
            .report-item span {
                font-size: 2.2rem;
            }
            .form-row {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 15px;
            }
            .form-group {
                flex: 1 1 180px;
                min-width: 150px;
            }
            .btn {
                width: auto;
                margin-bottom: 0;
            }
            .form-actions {
                flex-direction: row;
                justify-content: flex-end;
            }
            .filter-bar {
                flex-direction: column;
            }
            .filter-row {
                flex-direction: row;
                flex-wrap: wrap;
                align-items: flex-end;
            }
            .search-box {
                flex: 2 1 300px;
            }
            .filter-section {
                flex: 1 1 300px;
            }
            .checkbox-item {
                flex: 0 1 auto;
                min-width: auto;
            }
            .date-filter {
                flex-wrap: nowrap;
            }
            .table-wrapper {
                margin: 0;
            }
            .footer-note {
                text-align: right;
            }
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* –î–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 380px) {
            .checkbox-item {
                flex: 1 1 100%;
            }
            .report-panel {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ -->
    <script src="config.js"></script>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –ª–æ–≥–∏–Ω–∞ -->
    <div id="loginScreen" class="login-container">
        <h2>üîê –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
        <div class="login-form">
            <div class="form-group">
                <label>–õ–æ–≥–∏–Ω</label>
                <input type="text" id="loginUsername" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
            </div>
            <div class="form-group">
                <label>–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="loginPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
            </div>
            <button class="login-btn" id="loginBtn">–í–æ–π—Ç–∏</button>
            <div id="loginError" class="error-message"></div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–æ) -->
    <div id="appScreen" style="display: none;" class="container">
        <div class="header-with-logout">
            <div class="header-left">
                <h1>
                    üîß –£—á–µ—Ç - –ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å
                    <span id="syncStatus" class="sync-status sync-loading">üîÑ –ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    <span id="telegramStatus" class="telegram-status" onclick="testTelegram()" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ç–µ—Å—Ç–∞ Telegram">üì± –ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                </h1>
                <div class="theme-toggle" id="themeToggle">
                    <span id="themeLight" class="active">‚òÄÔ∏è</span>
                    <span id="themeDark">üåô</span>
                </div>
            </div>
            <div>
                <button class="stats-toggle-btn" id="toggleStatsBtn">üìä –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
                <button class="logout-btn" id="logoutBtn">–í—ã–π—Ç–∏</button>
            </div>
        </div>

        <!-- –û—Ç—á–µ—Ç -->
        <div class="report-panel">
            <div class="report-item">
                <span id="totalClients">0</span>
                <label>–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</label>
            </div>
            <div class="report-item">
                <span id="waitingCount">0</span>
                <label>–û–∂–∏–¥–∞–µ–º</label>
            </div>
            <div class="report-item">
                <span id="lateCount">0</span>
                <label>–û–ø–∞–∑–¥—ã–≤–∞—é—Ç</label>
            </div>
            <div class="report-item">
                <span id="doneCount">0</span>
                <label>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</label>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–∞) -->
        <div id="statsSection" class="stats-section" style="display: none;">
            <div class="stats-header">
                <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç</h3>
                <button class="btn-secondary" id="closeStatsBtn">‚úñ –ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>–ü–æ –º–µ—Å—è—Ü–∞–º</h4>
                    <div id="monthlyStats"></div>
                </div>
                
                <div class="stat-card">
                    <h4>–í—Å–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</h4>
                    <div id="totalDoneStats"></div>
                </div>
                
                <div class="stat-card">
                    <h4>–°—É–º–º–∞ –ø–æ –º–µ—Å—è—Ü–∞–º</h4>
                    <div id="monthlySumStats"></div>
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <h4>üõ¢Ô∏è –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–º–µ–Ω–µ –º–∞—Å–ª–∞</h4>
                <div id="oilReminders"></div>
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
        <div class="form-section">
            <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å / –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å</h3>
            <div class="form-row">
                <!-- ID —Å–∫—Ä—ã—Ç, –Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Ñ–æ—Ä–º–µ -->
                <input type="hidden" id="clientId" value="">
                
                <div class="form-group">
                    <label>–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</label>
                    <input type="text" id="userName" placeholder="–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤" autocomplete="off">
                </div>
                <div class="form-group">
                    <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input type="text" id="phone" placeholder="+7 (999) 123-45-67" autocomplete="off">
                </div>
                <div class="form-group">
                    <label>–ú–∞—Ä–∫–∞ –∞–≤—Ç–æ</label>
                    <input type="text" id="carModel" placeholder="Toyota Camry" autocomplete="off">
                </div>
                <div class="form-group">
                    <label>–î–∞—Ç–∞ –ø—Ä–∏–µ–∑–¥–∞</label>
                    <input type="date" id="visitDate">
                </div>
                <div class="form-group">
                    <label>–í—Ä–µ–º—è –ø—Ä–∏–µ–∑–¥–∞</label>
                    <input type="time" id="visitTime">
                </div>
                <div class="form-group">
                    <label>–ó–∞–º–µ–Ω–∞ –º–∞—Å–ª–∞</label>
                    <select id="oilChange">
                        <option value="–ù–µ—Ç">–ù–µ—Ç</option>
                        <option value="–î–∞">–î–∞</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–û–ø–ª–∞—Ç–∞ (‚ÇΩ)</label>
                    <input type="number" id="payment" placeholder="5000" min="0" step="1" value="0">
                </div>
                <div class="form-group">
                    <label>–°—Ç–∞—Ç—É—Å</label>
                    <select id="statusSelect">
                        <option value="waiting">–û–∂–∏–¥–∞–µ–º</option>
                        <option value="late">–û–ø–∞–∑–¥—ã–≤–∞–µ—Ç</option>
                        <option value="done">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</option>
                        <option value="notcome">–ù–µ –ø—Ä–∏–µ–¥–µ—Ç</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                    <textarea id="comment" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è..."></textarea>
                </div>
            </div>
            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="form-actions">
                <button class="btn" id="addBtn">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
                <button class="btn-secondary" id="updateBtn" style="display: none;">‚úÖ –û–±–Ω–æ–≤–∏—Ç—å</button>
                <button class="clear-btn btn" id="cancelEdit" style="display: none;">‚úñ –û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>

        <!-- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è -->
        <div class="filter-bar">
            <div class="filter-row">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="üîç –ü–æ–∏—Å–∫...">
                </div>
                
                <!-- –§–∏–ª—å—Ç—Ä –ø–æ –≥–æ–¥—É –∏ –º–µ—Å—è—Ü—É -->
                <div class="filter-section">
                    <label>–§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ –ø—Ä–∏–µ–∑–¥–∞:</label>
                    <div class="date-filter">
                        <select id="yearFilter">
                            <option value="all">–í—Å–µ –≥–æ–¥–∞</option>
                        </select>
                        <select id="monthFilter">
                            <option value="all">–í—Å–µ –º–µ—Å—è—Ü—ã</option>
                            <option value="1">–Ø–Ω–≤–∞—Ä—å</option>
                            <option value="2">–§–µ–≤—Ä–∞–ª—å</option>
                            <option value="3">–ú–∞—Ä—Ç</option>
                            <option value="4">–ê–ø—Ä–µ–ª—å</option>
                            <option value="5">–ú–∞–π</option>
                            <option value="6">–ò—é–Ω—å</option>
                            <option value="7">–ò—é–ª—å</option>
                            <option value="8">–ê–≤–≥—É—Å—Ç</option>
                            <option value="9">–°–µ–Ω—Ç—è–±—Ä—å</option>
                            <option value="10">–û–∫—Ç—è–±—Ä—å</option>
                            <option value="11">–ù–æ—è–±—Ä—å</option>
                            <option value="12">–î–µ–∫–∞–±—Ä—å</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="filter-row">
                <!-- –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º (–í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–Ω—è—Ç —Ñ–ª–∞–≥) -->
                <div class="filter-section">
                    <label>–§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º:</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" class="status-checkbox" value="waiting" checked> –û–∂–∏–¥–∞–µ–º
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" class="status-checkbox" value="late" checked> –û–ø–∞–∑–¥—ã–≤–∞–µ—Ç
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" class="status-checkbox" value="done"> –í—ã–ø–æ–ª–Ω–µ–Ω–æ
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" class="status-checkbox" value="notcome" checked> –ù–µ –ø—Ä–∏–µ–¥–µ—Ç
                        </label>
                    </div>
                </div>

                <!-- –§–∏–ª—å—Ç—Ä –ø–æ –∑–∞–º–µ–Ω–µ –º–∞—Å–ª–∞ -->
                <div class="filter-section">
                    <label>–§–∏–ª—å—Ç—Ä –ø–æ –∑–∞–º–µ–Ω–µ –º–∞—Å–ª–∞ <span class="info-badge">330 –¥–Ω–µ–π</span>:</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" id="oilYes" checked> –î–∞
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="oilNo" checked> –ù–µ—Ç
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="oilSoon"> –°–∫–æ—Ä–æ –∑–∞–º–µ–Ω–∞
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
        <div class="table-wrapper">
            <table id="clientsTable">
                <thead>
                    <tr>
                        <th>–ö–ª–∏–µ–Ω—Ç</th>
                        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                        <th>–ú–∞—Ä–∫–∞ –∞–≤—Ç–æ</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–í—Ä–µ–º—è</th>
                        <th>–ú–∞—Å–ª–æ</th>
                        <th>–û–ø–ª–∞—Ç–∞ (‚ÇΩ)</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </tbody>
            </table>
        </div>
        <div class="footer-note">
            * –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ ID. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Ç–∞—Ç—É—Å Telegram –¥–ª—è —Ç–µ—Å—Ç–∞.
        </div>
    </div>

<script>
    (function() {
        // ========== –ü–†–û–í–ï–†–ö–ê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò ==========
        if (typeof JSONBIN_CONFIG === 'undefined' || typeof TELEGRAM_CONFIG === 'undefined' || typeof AUTH_CONFIG === 'undefined') {
            alert('–û—à–∏–±–∫–∞: —Ñ–∞–π–ª config.js –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω!');
        }

        // ========== –¢–ï–ú–ù–ê–Ø –¢–ï–ú–ê ==========
        const themeToggle = document.getElementById('themeToggle');
        const themeLight = document.getElementById('themeLight');
        const themeDark = document.getElementById('themeDark');
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Ç–µ–º—ã
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateThemeButtons(savedTheme);
        
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeButtons(newTheme);
        });
        
        function updateThemeButtons(theme) {
            if (theme === 'light') {
                themeLight.classList.add('active');
                themeDark.classList.remove('active');
            } else {
                themeLight.classList.remove('active');
                themeDark.classList.add('active');
            }
        }

        // ========== –õ–û–ì–ò–†–û–í–ê–ù–ò–ï ==========
        const LOGIN_SCREEN = document.getElementById('loginScreen');
        const APP_SCREEN = document.getElementById('appScreen');
        const LOGIN_BTN = document.getElementById('loginBtn');
        const LOGOUT_BTN = document.getElementById('logoutBtn');
        const SYNC_STATUS = document.getElementById('syncStatus');
        const TELEGRAM_STATUS = document.getElementById('telegramStatus');
        const LOGIN_ERROR = document.getElementById('loginError');
        const STATS_SECTION = document.getElementById('statsSection');
        const TOGGLE_STATS_BTN = document.getElementById('toggleStatsBtn');
        const CLOSE_STATS_BTN = document.getElementById('closeStatsBtn');
        
        function setSyncStatus(status, message) {
            if (SYNC_STATUS) {
                SYNC_STATUS.className = 'sync-status ' + status;
                SYNC_STATUS.textContent = message;
            }
        }
        
        function setTelegramStatus(status, message) {
            if (TELEGRAM_STATUS) {
                TELEGRAM_STATUS.className = 'telegram-status ' + status;
                TELEGRAM_STATUS.textContent = message;
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function checkAuth() {
            const isAuthenticated = sessionStorage.getItem('auth') === 'true';
            if (isAuthenticated) {
                showApp();
            } else {
                showLogin();
            }
        }
        
        function showApp() {
            LOGIN_SCREEN.style.display = 'none';
            APP_SCREEN.style.display = 'block';
            if (!window.appInitialized) {
                initApp();
                window.appInitialized = true;
            }
        }
        
        function showLogin() {
            LOGIN_SCREEN.style.display = 'block';
            APP_SCREEN.style.display = 'none';
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —Å–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
        LOGIN_BTN.addEventListener('click', function() {
            const username = document.getElementById('loginUsername').value.toLowerCase().trim();
            const password = document.getElementById('loginPassword').value;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ —Å–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
            const user = AUTH_CONFIG.USERS.find(u => 
                u.username.toLowerCase() === username && u.password === password
            );
            
            if (user) {
                sessionStorage.setItem('auth', 'true');
                sessionStorage.setItem('username', username);
                LOGIN_ERROR.textContent = '';
                showApp();
            } else {
                LOGIN_ERROR.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
            }
        });
        
        LOGOUT_BTN.addEventListener('click', function() {
            sessionStorage.removeItem('auth');
            sessionStorage.removeItem('username');
            showLogin();
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        checkAuth();

        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        TOGGLE_STATS_BTN.addEventListener('click', function() {
            if (STATS_SECTION.style.display === 'none') {
                updateStats();
                STATS_SECTION.style.display = 'block';
                TOGGLE_STATS_BTN.textContent = 'üìä –°–∫—Ä—ã—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É';
            } else {
                STATS_SECTION.style.display = 'none';
                TOGGLE_STATS_BTN.textContent = 'üìä –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É';
            }
        });
        
        CLOSE_STATS_BTN.addEventListener('click', function() {
            STATS_SECTION.style.display = 'none';
            TOGGLE_STATS_BTN.textContent = 'üìä –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É';
        });

        // ========== –§–£–ù–ö–¶–ò–ò –î–õ–Ø TELEGRAM ==========
        async function sendTelegramNotification(record) {
            if (!TELEGRAM_CONFIG || !TELEGRAM_CONFIG.BOT_TOKEN || !TELEGRAM_CONFIG.CHAT_ID) {
                console.log('Telegram –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
                setTelegramStatus('telegram-error', 'üìµ –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
                return;
            }

            // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            const statusText = {
                'waiting': '–û–∂–∏–¥–∞–µ–º',
                'late': '–û–ø–∞–∑–¥—ã–≤–∞–µ—Ç',
                'done': '–í—ã–ø–æ–ª–Ω–µ–Ω–æ',
                'notcome': '–ù–µ –ø—Ä–∏–µ–¥–µ—Ç'
            }[record.status] || record.status;

            const message = `
üÜï –ù–û–í–´–ô –ö–õ–ò–ï–ù–¢ –î–û–ë–ê–í–õ–ï–ù!

üîπ ID: ${record.id || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
üë§ –ò–º—è: ${record.name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
üìû –¢–µ–ª–µ—Ñ–æ–Ω: ${record.phone || '–ù–µ —É–∫–∞–∑–∞–Ω'}
üöó –ê–≤—Ç–æ: ${record.carModel || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
üìÖ –î–∞—Ç–∞: ${record.visitDate || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}
‚è∞ –í—Ä–µ–º—è: ${record.visitTime || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
üõ¢Ô∏è –ú–∞—Å–ª–æ: ${record.oilChange || '–ù–µ—Ç'}
üí∞ –û–ø–ª–∞—Ç–∞: ${record.payment || 0} ‚ÇΩ
üìä –°—Ç–∞—Ç—É—Å: ${statusText}
üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${record.comment || '–ù–µ—Ç'}
            `.trim();

            try {
                console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram...');
                setTelegramStatus('telegram-warning', 'üì§ –û—Ç–ø—Ä–∞–≤–∫–∞...');
                
                const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_CONFIG.BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: TELEGRAM_CONFIG.CHAT_ID,
                        text: message
                    })
                });

                const result = await response.json();
                console.log('–û—Ç–≤–µ—Ç Telegram:', result);

                if (response.ok && result.ok) {
                    console.log('‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
                    setTelegramStatus('telegram-success', 'üì± Telegram OK');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                    const toast = document.createElement('div');
                    toast.style.cssText = 'position:fixed; bottom:20px; right:20px; background:#48bb78; color:white; padding:10px 20px; border-radius:10px; z-index:1000; box-shadow:0 2px 10px rgba(0,0,0,0.1); animation:slideIn 0.3s;';
                    toast.textContent = '‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram';
                    document.body.appendChild(toast);
                    setTimeout(() => toast.remove(), 3000);
                    
                    return true;
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram:', result.description);
                    
                    let errorMessage = '‚ö†Ô∏è –û—à–∏–±–∫–∞ Telegram';
                    if (result.description === 'Forbidden: bot was blocked by the user') {
                        errorMessage = 'üî¥ –ë–æ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω';
                        alert('‚ùå –ë–æ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω! –†–∞–∑–±–ª–æ–∫–∏—Ä—É–π—Ç–µ –±–æ—Ç–∞ @Serviquest36_bot');
                    } else if (result.description === 'Bad Request: chat not found') {
                        errorMessage = 'üî¥ Chat ID –Ω–µ –Ω–∞–π–¥–µ–Ω';
                        alert('‚ùå Chat ID –Ω–µ –Ω–∞–π–¥–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ config.js');
                    }
                    
                    setTelegramStatus('telegram-error', errorMessage);
                    return false;
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ Telegram:', e);
                setTelegramStatus('telegram-error', '‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                return false;
            }
        }

        // –¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Telegram
        window.testTelegram = async function() {
            setTelegramStatus('telegram-warning', 'üì§ –¢–µ—Å—Ç...');
            
            const testRecord = {
                id: 'TEST-001',
                name: '–¢–ï–°–¢–û–í–´–ô –ö–õ–ò–ï–ù–¢',
                phone: '+7 999 999-99-99',
                carModel: '–¢–µ—Å—Ç –ê–≤—Ç–æ',
                visitDate: new Date().toISOString().split('T')[0],
                visitTime: new Date().toLocaleTimeString().slice(0,5),
                oilChange: '–î–∞',
                payment: 1000,
                status: 'waiting',
                comment: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'
            };
            
            const result = await sendTelegramNotification(testRecord);
            
            if (!result) {
                alert(`
‚ùå Telegram –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!

–ß—Ç–æ –¥–µ–ª–∞—Ç—å:
1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
2. –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ @Serviquest36_bot
3. –ù–∞–∂–º–∏—Ç–µ START –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ /start
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞
                `);
            }
        };

        // ========== –û–°–ù–û–í–ù–û–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ ==========
        const STORAGE_KEY = 'autoserviceData';
        const OIL_CHANGE_DAYS = 330;
        let editingId = null;
        let records = [];
        let syncTimeout = null;

        // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ID –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
        function generateDateTimeId() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            
            return `K-${year}${month}${day}-${hours}${minutes}`;
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            const monthlyStats = document.getElementById('monthlyStats');
            const totalDoneStats = document.getElementById('totalDoneStats');
            const monthlySumStats = document.getElementById('monthlySumStats');
            const oilReminders = document.getElementById('oilReminders');
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã
            const doneRecords = records.filter(r => r.status === 'done' && r.visitDate);
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –º–µ—Å—è—Ü–∞–º
            const monthlyData = {};
            let totalDone = 0;
            let totalSum = 0;
            
            doneRecords.forEach(record => {
                const date = new Date(record.visitDate);
                const monthYear = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                const monthName = date.toLocaleString('ru-RU', { month: 'long', year: 'numeric' });
                
                if (!monthlyData[monthYear]) {
                    monthlyData[monthYear] = {
                        name: monthName,
                        count: 0,
                        sum: 0
                    };
                }
                
                monthlyData[monthYear].count++;
                monthlyData[monthYear].sum += Number(record.payment) || 0;
                totalDone++;
                totalSum += Number(record.payment) || 0;
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (—Å–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ)
            const sortedMonths = Object.keys(monthlyData).sort().reverse();
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –º–µ—Å—è—Ü–∞–º
            monthlyStats.innerHTML = '';
            sortedMonths.forEach(monthKey => {
                const data = monthlyData[monthKey];
                const div = document.createElement('div');
                div.className = 'stat-row';
                div.innerHTML = `
                    <span class="stat-label">${data.name}:</span>
                    <span class="stat-value">${data.count} —à—Ç</span>
                `;
                monthlyStats.appendChild(div);
            });
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            totalDoneStats.innerHTML = `
                <div class="stat-row">
                    <span class="stat-label">–í—Å–µ–≥–æ —Ä–∞–±–æ—Ç:</span>
                    <span class="stat-value">${totalDone} —à—Ç</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–û–±—â–∞—è —Å—É–º–º–∞:</span>
                    <span class="stat-value">${totalSum.toLocaleString('ru-RU')} ‚ÇΩ</span>
                </div>
            `;
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—É–º–º—ã –ø–æ –º–µ—Å—è—Ü–∞–º
            monthlySumStats.innerHTML = '';
            sortedMonths.forEach(monthKey => {
                const data = monthlyData[monthKey];
                const div = document.createElement('div');
                div.className = 'stat-row';
                div.innerHTML = `
                    <span class="stat-label">${data.name}:</span>
                    <span class="stat-value">${data.sum.toLocaleString('ru-RU')} ‚ÇΩ</span>
                `;
                monthlySumStats.appendChild(div);
            });
            
            // –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–º–µ–Ω–µ –º–∞—Å–ª–∞ (–∫–ª–∏–µ–Ω—Ç—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–í—ã–ø–æ–ª–Ω–µ–Ω–æ" –∏ –º–∞—Å–ª–æ–º "–î–∞", —É –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ—à–ª–æ 330 –¥–Ω–µ–π)
            const oilReminderRecords = records.filter(r => 
                r.status === 'done' && 
                r.oilChange === '–î–∞' && 
                r.visitDate &&
                r.phone
            );
            
            oilReminders.innerHTML = '';
            
            if (oilReminderRecords.length === 0) {
                oilReminders.innerHTML = '<p>–ù–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</p>';
            } else {
                const list = document.createElement('div');
                list.className = 'reminder-list';
                
                oilReminderRecords.forEach(record => {
                    const daysSince = Math.floor((new Date() - new Date(record.visitDate)) / (1000 * 60 * 60 * 24));
                    const daysUntil = OIL_CHANGE_DAYS - daysSince;
                    
                    if (daysUntil <= 30) { // –ù–∞–ø–æ–º–∏–Ω–∞–µ–º –∑–∞ 30 –¥–Ω–µ–π –¥–æ –∏ –ø–æ—Å–ª–µ
                        const item = document.createElement('div');
                        item.className = 'reminder-item';
                        
                        let statusText = '';
                        if (daysUntil > 0) {
                            statusText = `‚è≥ —á–µ—Ä–µ–∑ ${daysUntil} –¥–Ω–µ–π`;
                        } else {
                            statusText = `‚ùó –ø—Ä–æ—à–ª–æ ${Math.abs(daysUntil)} –¥–Ω–µ–π`;
                        }
                        
                        item.innerHTML = `
                            <div>
                                <strong>${escapeHtml(record.name)}</strong><br>
                                ${escapeHtml(record.carModel)} - ${escapeHtml(record.phone)}<br>
                                <small>${statusText}</small>
                            </div>
                            <div class="reminder-contact">
                                <button onclick="window.location.href='tel:${escapeHtml(record.phone)}'">üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å</button>
                            </div>
                        `;
                        list.appendChild(item);
                    }
                });
                
                if (list.children.length === 0) {
                    oilReminders.innerHTML = '<p>–ù–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è</p>';
                } else {
                    oilReminders.appendChild(list);
                }
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å JSONbin.io
        async function loadFromServer() {
            if (!JSONBIN_CONFIG) {
                setSyncStatus('sync-error', '‚ùå –ù–µ—Ç –∫–æ–Ω—Ñ–∏–≥–∞');
                loadFromStorage();
                return;
            }
            
            setSyncStatus('sync-loading', 'üîÑ –ó–∞–≥—Ä—É–∑–∫–∞...');
            
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_CONFIG.BIN_ID}/latest`, {
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.MASTER_KEY
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    records = data.record || [];
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –∫–∞–∫ –±—ç–∫–∞–ø
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
                    updateYearFilter();
                    renderTable();
                    if (STATS_SECTION.style.display !== 'none') {
                        updateStats();
                    }
                    setSyncStatus('sync-success', '‚úì –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
                    return true;
                } else if (response.status === 404) {
                    // –ë–∏–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
                    records = getInitialData();
                    await saveToServer();
                    updateYearFilter();
                    renderTable();
                    return true;
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
                }
            } catch (e) {
                console.error('Load error:', e);
                setSyncStatus('sync-error', '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                loadFromStorage();
                return false;
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ JSONbin.io
        async function saveToServer() {
            if (!JSONBIN_CONFIG) {
                setSyncStatus('sync-error', '‚ùå –ù–µ—Ç –∫–æ–Ω—Ñ–∏–≥–∞');
                return false;
            }
            
            setSyncStatus('sync-loading', 'üîÑ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...');
            
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_CONFIG.BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_CONFIG.MASTER_KEY
                    },
                    body: JSON.stringify(records)
                });
                
                if (response.ok) {
                    setSyncStatus('sync-success', '‚úì –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
                    return true;
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                }
            } catch (e) {
                console.error('Save error:', e);
                setSyncStatus('sync-error', '‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                return false;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
        function loadFromStorage() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                try {
                    records = JSON.parse(stored);
                    setSyncStatus('sync-warning', '‚ö†Ô∏è –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
                } catch (e) {
                    records = [];
                }
            } else {
                records = [];
            }
            updateYearFilter();
            renderTable();
        }

        // –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º ID
        function getInitialData() {
            const today = new Date();
            const threeMonthsAgo = new Date(today);
            threeMonthsAgo.setMonth(today.getMonth() - 3);
            
            const elevenMonthsAgo = new Date(today);
            elevenMonthsAgo.setMonth(today.getMonth() - 11);
            
            const formatDate = (date) => {
                return date.toISOString().split('T')[0];
            };

            const formatDateTimeId = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                return `K-${year}${month}${day}-${hours}${minutes}`;
            };

            return [
                { 
                    id: formatDateTimeId(threeMonthsAgo), 
                    name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', 
                    phone: '+7 999 111-22-33', 
                    carModel: 'Toyota Camry',
                    visitDate: formatDate(threeMonthsAgo),
                    visitTime: '10:30',
                    oilChange: '–î–∞',
                    payment: 5000,
                    status: 'waiting',
                    comment: '–ü—Ä–æ—Å–∏–ª –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä'
                },
                { 
                    id: 'K-20260213-1400', 
                    name: '–ï–ª–µ–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞', 
                    phone: '+7 999 222-33-44', 
                    carModel: 'KIA Rio',
                    visitDate: '2026-02-13',
                    visitTime: '14:00',
                    oilChange: '–ù–µ—Ç',
                    payment: 3500,
                    status: 'done',
                    comment: '–ó–∞–º–µ–Ω–∞ —Ç–æ—Ä–º–æ–∑–Ω—ã—Ö –∫–æ–ª–æ–¥–æ–∫'
                },
                { 
                    id: formatDateTimeId(elevenMonthsAgo), 
                    name: '–ü–µ—Ç—Ä –°–∏–¥–æ—Ä–æ–≤', 
                    phone: '+7 999 333-44-55', 
                    carModel: 'BMW X5',
                    visitDate: formatDate(elevenMonthsAgo),
                    visitTime: '09:15',
                    oilChange: '–î–∞',
                    payment: 12000,
                    status: 'done',
                    comment: '–°—Ä–æ—á–Ω–æ, –∑–≤–æ–Ω–∏–ª —É–∂–µ 2 —Ä–∞–∑–∞'
                },
                { 
                    id: 'K-20260214-1645', 
                    name: '–ê–Ω–Ω–∞ –ò–≤–∞–Ω–æ–≤–∞', 
                    phone: '+7 999 444-55-66', 
                    carModel: 'Hyundai Solaris',
                    visitDate: '2026-02-14',
                    visitTime: '16:45',
                    oilChange: '–î–∞',
                    payment: 4500,
                    status: 'done',
                    comment: '–ü–µ—Ä–µ–Ω–µ—Å–ª–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é'
                }
            ];
        }

        function saveToStorage() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
            localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
            
            // –û—Ç–∫–ª–∞–¥—ã–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (—á—Ç–æ–±—ã –Ω–µ —Å–ø–∞–º–∏—Ç—å –∑–∞–ø—Ä–æ—Å–∞–º–∏)
            if (syncTimeout) clearTimeout(syncTimeout);
            syncTimeout = setTimeout(() => {
                saveToServer();
            }, 2000);
        }

        function isOilChangeSoon(visitDate, oilChange) {
            if (oilChange !== '–î–∞' || !visitDate) return false;
            
            const visit = new Date(visitDate);
            const today = new Date();
            
            const diffTime = today - visit;
            const diffDays = diffTime / (1000 * 60 * 60 * 24);
            
            return diffDays >= OIL_CHANGE_DAYS;
        }

        function generateNewId() {
            return generateDateTimeId();
        }

        function updateReport() {
            const total = records.length;
            let waiting = 0, late = 0, done = 0, notcome = 0;

            records.forEach(r => {
                if (r.status === 'waiting') waiting++;
                else if (r.status === 'late') late++;
                else if (r.status === 'done') done++;
                else if (r.status === 'notcome') notcome++;
            });

            document.getElementById('totalClients').innerText = total;
            document.getElementById('waitingCount').innerText = waiting;
            document.getElementById('lateCount').innerText = late;
            document.getElementById('doneCount').innerText = done;
        }

        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return String(unsafe)
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function getStatusInfo(status) {
            switch(status) {
                case 'done': return { text: '–í—ã–ø–æ–ª–Ω–µ–Ω–æ', class: 'status-done' };
                case 'late': return { text: '–û–ø–∞–∑–¥—ã–≤–∞–µ—Ç', class: 'status-late' };
                case 'notcome': return { text: '–ù–µ –ø—Ä–∏–µ–¥–µ—Ç', class: 'status-notcome' };
                case 'waiting':
                default: return { text: '–û–∂–∏–¥–∞–µ–º', class: 'status-waiting' };
            }
        }

        function getSelectedStatuses() {
            const checkboxes = document.querySelectorAll('.status-checkbox');
            const selected = [];
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    selected.push(cb.value);
                }
            });
            return selected;
        }

        function getSelectedOilValues() {
            const selected = [];
            if (document.getElementById('oilYes').checked) selected.push('–î–∞');
            if (document.getElementById('oilNo').checked) selected.push('–ù–µ—Ç');
            return selected;
        }

        function formatPayment(amount) {
            if (amount === undefined || amount === null || amount === '') return '0';
            const num = Number(amount);
            return num.toLocaleString('ru-RU');
        }

        function calculateTotal(filteredRecords) {
            return filteredRecords.reduce((sum, record) => {
                const payment = Number(record.payment) || 0;
                return sum + payment;
            }, 0);
        }

        function updateYearFilter() {
            const yearSelect = document.getElementById('yearFilter');
            const years = new Set();
            
            records.forEach(record => {
                if (record.visitDate) {
                    const year = new Date(record.visitDate).getFullYear();
                    years.add(year);
                }
            });
            
            const sortedYears = Array.from(years).sort((a, b) => b - a);
            
            const currentValue = yearSelect.value;
            
            yearSelect.innerHTML = '<option value="all">–í—Å–µ –≥–æ–¥–∞</option>';
            sortedYears.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            });
            
            if (currentValue && currentValue !== 'all') {
                if (sortedYears.includes(parseInt(currentValue))) {
                    yearSelect.value = currentValue;
                } else {
                    yearSelect.value = 'all';
                }
            }
        }

        function getSelectedYear() {
            const yearValue = document.getElementById('yearFilter').value;
            return yearValue === 'all' ? null : parseInt(yearValue);
        }

        function getSelectedMonth() {
            const monthValue = document.getElementById('monthFilter').value;
            return monthValue === 'all' ? null : parseInt(monthValue);
        }

        function renderTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            const selectedStatuses = getSelectedStatuses();
            const selectedOilValues = getSelectedOilValues();
            const oilSoonChecked = document.getElementById('oilSoon').checked;
            const selectedYear = getSelectedYear();
            const selectedMonth = getSelectedMonth();

            // –°–Ω–∞—á–∞–ª–∞ —Ñ–∏–ª—å—Ç—Ä—É–µ–º
            let filtered = records.filter(record => {
                const matchesSearch = 
                    record.name.toLowerCase().includes(searchTerm) ||
                    record.phone.toLowerCase().includes(searchTerm) ||
                    (record.carModel && record.carModel.toLowerCase().includes(searchTerm)) ||
                    (record.comment && record.comment.toLowerCase().includes(searchTerm));

                if (!matchesSearch) return false;

                if (selectedStatuses.length > 0 && !selectedStatuses.includes(record.status)) {
                    return false;
                }

                const oilSoon = isOilChangeSoon(record.visitDate, record.oilChange);
                
                if (oilSoonChecked) {
                    if (!oilSoon) return false;
                } else {
                    if (selectedOilValues.length > 0 && !selectedOilValues.includes(record.oilChange || '–ù–µ—Ç')) {
                        return false;
                    }
                }

                if (record.visitDate) {
                    const visitDate = new Date(record.visitDate);
                    const visitYear = visitDate.getFullYear();
                    const visitMonth = visitDate.getMonth() + 1;
                    
                    if (selectedYear && visitYear !== selectedYear) {
                        return false;
                    }
                    
                    if (selectedMonth && visitMonth !== selectedMonth) {
                        return false;
                    }
                } else {
                    if (selectedYear || selectedMonth) return false;
                }

                return true;
            });

            // –°–û–†–¢–ò–†–û–í–ö–ê: —Å–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ, –ø–æ—Ç–æ–º —Å—Ç–∞—Ä—ã–µ –ø–æ visitDate
            filtered.sort((a, b) => {
                if (!a.visitDate && !b.visitDate) return 0;
                if (!a.visitDate) return 1; // –∑–∞–ø–∏—Å–∏ –±–µ–∑ –¥–∞—Ç—ã –≤ –∫–æ–Ω–µ—Ü
                if (!b.visitDate) return -1;
                
                const dateA = new Date(a.visitDate);
                const dateB = new Date(b.visitDate);
                
                // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —É–±—ã–≤–∞–Ω–∏—é (—Å–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ)
                return dateB - dateA;
            });

            const totalSum = calculateTotal(filtered);

            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align:center; padding:40px;">–ó–∞–ø–∏—Å–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td></tr>';
            } else {
                filtered.forEach(record => {
                    const statusInfo = getStatusInfo(record.status);
                    const oilSoon = isOilChangeSoon(record.visitDate, record.oilChange);
                    
                    let oilClass = record.oilChange === '–î–∞' ? 'oil-yes' : 'oil-no';
                    let oilText = record.oilChange || '–ù–µ—Ç';
                    
                    if (oilSoon) {
                        oilClass = 'oil-soon';
                        oilText = '–°–∫–æ—Ä–æ';
                    }

                    const row = document.createElement('tr');
                    // ID –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º, –Ω–æ —Ö—Ä–∞–Ω–∏–º –≤ data-–∞—Ç—Ä–∏–±—É—Ç–µ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π
                    row.setAttribute('data-id', record.id);
                    row.innerHTML = `
                        <td>${escapeHtml(record.name)}</td>
                        <td>${escapeHtml(record.phone)}</td>
                        <td>${escapeHtml(record.carModel || '')}</td>
                        <td>${escapeHtml(record.visitDate || '')}</td>
                        <td>${escapeHtml(record.visitTime || '')}</td>
                        <td><span class="oil-badge ${oilClass}">${escapeHtml(oilText)}</span></td>
                        <td class="payment-cell">${formatPayment(record.payment)} ‚ÇΩ</td>
                        <td><span class="status-badge ${statusInfo.class}">${statusInfo.text}</span></td>
                        <td class="comment-cell">${escapeHtml(record.comment || '')}</td>
                        <td class="actions">
                            <button class="edit-btn" data-id="${escapeHtml(record.id)}" title="–†–µ–¥.">‚úèÔ∏è</button>
                            <button class="delete-btn" data-id="${escapeHtml(record.id)}" title="–£–¥.">üóëÔ∏è</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                const totalRow = document.createElement('tr');
                totalRow.className = 'total-row';
                totalRow.innerHTML = `
                    <td colspan="6" style="text-align: right; font-weight: 700;">–ò–¢–û–ì–û:</td>
                    <td class="payment-cell" style="font-weight: 700;">${formatPayment(totalSum)} ‚ÇΩ</td>
                    <td colspan="3"></td>
                `;
                tbody.appendChild(totalRow);
            }
            updateReport();
        }

        function clearForm() {
            document.getElementById('clientId').value = generateDateTimeId();
            document.getElementById('userName').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('carModel').value = '';
            document.getElementById('visitDate').value = '';
            document.getElementById('visitTime').value = '';
            document.getElementById('oilChange').value = '–ù–µ—Ç';
            document.getElementById('payment').value = '0';
            document.getElementById('statusSelect').value = 'waiting';
            document.getElementById('comment').value = '';
            editingId = null;
            document.getElementById('addBtn').style.display = 'inline-block';
            document.getElementById('updateBtn').style.display = 'none';
            document.getElementById('cancelEdit').style.display = 'none';
        }

        function fillFormForEdit(record) {
            document.getElementById('clientId').value = record.id;
            document.getElementById('userName').value = record.name || '';
            document.getElementById('phone').value = record.phone || '';
            document.getElementById('carModel').value = record.carModel || '';
            document.getElementById('visitDate').value = record.visitDate || '';
            document.getElementById('visitTime').value = record.visitTime || '';
            document.getElementById('oilChange').value = record.oilChange || '–ù–µ—Ç';
            document.getElementById('payment').value = record.payment || 0;
            document.getElementById('statusSelect').value = record.status || 'waiting';
            document.getElementById('comment').value = record.comment || '';
            editingId = record.id;
            document.getElementById('addBtn').style.display = 'none';
            document.getElementById('updateBtn').style.display = 'inline-block';
            document.getElementById('cancelEdit').style.display = 'inline-block';
        }

        function addRecord() {
            const clientId = document.getElementById('clientId').value.trim();
            const name = document.getElementById('userName').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const carModel = document.getElementById('carModel').value.trim();
            const visitDate = document.getElementById('visitDate').value;
            const visitTime = document.getElementById('visitTime').value;
            const oilChange = document.getElementById('oilChange').value;
            const payment = document.getElementById('payment').value ? Number(document.getElementById('payment').value) : 0;
            const status = document.getElementById('statusSelect').value;
            const comment = document.getElementById('comment').value.trim();

            if (!name || !phone) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω.');
                return;
            }

            if (records.some(r => r.id === clientId)) {
                document.getElementById('clientId').value = generateDateTimeId() + '-1';
                alert('–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ID —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                return;
            }

            const newRecord = {
                id: clientId,
                name,
                phone,
                carModel,
                visitDate,
                visitTime,
                oilChange,
                payment,
                status,
                comment
            };

            records.push(newRecord);
            
            sendTelegramNotification(newRecord);
            
            saveToStorage();
            updateYearFilter();
            clearForm();
            renderTable();
        }

        function updateRecord() {
            const clientId = document.getElementById('clientId').value.trim();
            const name = document.getElementById('userName').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const carModel = document.getElementById('carModel').value.trim();
            const visitDate = document.getElementById('visitDate').value;
            const visitTime = document.getElementById('visitTime').value;
            const oilChange = document.getElementById('oilChange').value;
            const payment = document.getElementById('payment').value ? Number(document.getElementById('payment').value) : 0;
            const status = document.getElementById('statusSelect').value;
            const comment = document.getElementById('comment').value.trim();

            if (!name || !phone) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω.');
                return;
            }

            const index = records.findIndex(r => r.id === editingId);
            if (index === -1) {
                alert('–û—à–∏–±–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: –∑–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.');
                clearForm();
                renderTable();
                return;
            }

            if (editingId !== clientId && records.some(r => r.id === clientId)) {
                alert('–ó–∞–ø–∏—Å—å —Å —Ç–∞–∫–∏–º ID —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.');
                return;
            }

            records[index] = {
                id: clientId,
                name,
                phone,
                carModel,
                visitDate,
                visitTime,
                oilChange,
                payment,
                status,
                comment
            };

            saveToStorage();
            updateYearFilter();
            clearForm();
            renderTable();
        }

        function deleteRecord(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')) {
                records = records.filter(r => r.id !== id);
                saveToStorage();
                updateYearFilter();
                if (editingId === id) clearForm();
                renderTable();
            }
        }

        function init() {
            loadFromServer();

            document.getElementById('clientId').value = generateDateTimeId();
            
            document.getElementById('addBtn').addEventListener('click', addRecord);
            document.getElementById('updateBtn').addEventListener('click', updateRecord);
            document.getElementById('cancelEdit').addEventListener('click', clearForm);
            
            document.getElementById('searchInput').addEventListener('input', renderTable);
            
            const statusCheckboxes = document.querySelectorAll('.status-checkbox');
            statusCheckboxes.forEach(cb => {
                cb.addEventListener('change', renderTable);
            });

            document.getElementById('oilYes').addEventListener('change', renderTable);
            document.getElementById('oilNo').addEventListener('change', renderTable);
            document.getElementById('oilSoon').addEventListener('change', renderTable);
            
            document.getElementById('yearFilter').addEventListener('change', renderTable);
            document.getElementById('monthFilter').addEventListener('change', renderTable);

            document.getElementById('tableBody').addEventListener('click', (e) => {
                const target = e.target.closest('button');
                if (!target) return;

                const id = target.getAttribute('data-id');
                if (target.classList.contains('delete-btn')) {
                    deleteRecord(id);
                } else if (target.classList.contains('edit-btn')) {
                    const record = records.find(r => r.id === id);
                    if (record) fillFormForEdit(record);
                }
            });

            setInterval(() => {
                if (document.getElementById('appScreen').style.display !== 'none') {
                    loadFromServer();
                }
            }, 30000);
        }

        document.addEventListener('DOMContentLoaded', init);
    })();
</script>
</body>
</html>
